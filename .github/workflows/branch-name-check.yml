name: Branch Name Check

on:
  pull_request:
    types: [opened, reopened, synchronize]

jobs:
  check-branch-name:
    name: Validate branch naming convention
    runs-on: ubuntu-latest

    steps:
      - name: Check branch name
        run: |
          BRANCH="${{ github.head_ref }}"
          echo "Branch: $BRANCH"

          # Skip check for Copilot-managed branches — they merge into feature branches
          if echo "$BRANCH" | grep -qE '^copilot/'; then
            echo "✅ Copilot-managed branch — skipping convention check"
            exit 0
          fi

          # Valid patterns:
          # feat/issue-{number}-{description}
          # fix/issue-{number}-{description}
          # chore/{description}
          # docs/{description}
          if echo "$BRANCH" | grep -qE '^(feat|fix)/issue-[0-9]+-[a-z0-9-]+$'; then
            echo "Branch name is valid (feature/fix with issue number)"
            exit 0
          fi

          if echo "$BRANCH" | grep -qE '^(chore|docs)/[a-z0-9-]+$'; then
            echo "Branch name is valid (chore/docs without issue number)"
            exit 0
          fi

          echo ""
          echo "❌ Branch name '$BRANCH' does not follow the required convention."
          echo ""
          echo "Valid patterns:"
          echo "  feat/issue-{number}-{short-description}   e.g. feat/issue-2-profiles-table"
          echo "  fix/issue-{number}-{short-description}    e.g. fix/issue-9-router-redirect"
          echo "  chore/{short-description}                 e.g. chore/upgrade-flutter-deps"
          echo "  docs/{short-description}                  e.g. docs/update-setup-guide"
          echo ""
          echo "See CONTRIBUTING.md for the full branching convention."
          exit 1
